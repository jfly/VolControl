<html>
<head>
<title>VolCunt</title>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />

<!-- Stolen from http://www.iicns.com/ -->
<link rel="apple-touch-icon-precomposed" href="s256_mzm.euoiprzs.png" />  
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">


<script src="/socket.io/socket.io.js"></script>
<script src="ender.js"></script>
<script>
    var socket = io.connect(location.protocol + "//" + location.host);

    window.addEventListener("load", function() {
        var volumeInput = null;
        var mutedInput = null;
        function createOrUpdateVolume(data) {
            if(volumeInput === null) {
                volumeInput = document.createElement('input');
                volumeInput.classList.add('volume');
                volumeInput.type = 'range';
                volumeInput.min = 0;
                volumeInput.max = 100;
                volumeInput.step = 0;
                document.body.appendChild(volumeInput);

                mutedInput = document.createElement('input');
                mutedInput.type = 'checkbox';
                document.body.appendChild(mutedInput);

                function sendData() {
                    socket.emit('volume', getData());
                }
                volumeInput.addEventListener("change", sendData);
                mutedInput.addEventListener("change", sendData);
            }

            volumeInput.value = data.volume;
            mutedInput.checked = data.muted;
        }

        function getData() {
            return { volume: parseInt(volumeInput.value), muted: mutedInput.checked };
        }

        socket.on('volume', function(data) {
            // TODO - don't update if ui is currently being changed...
            createOrUpdateVolume(data);
        });

        socket.on('error', function(e) {
            alert(e);
        });

        document.addEventListener('touchmove', function (e) {
            if(e.target == volumeInput) {
                // TODO - replace with custom ui components,
                // the default ones aren't big enough...
                return;
            }
            e.preventDefault();
        }, false);
    });
</script>

<style type="text/css">
.volume {
    height: 100%;
    -webkit-appearance: slider-vertical;
}
</style>

</head>
<body>

</body>
</html>
